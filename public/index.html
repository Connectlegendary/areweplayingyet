<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>AreWePlayingYet?</title>
  <meta name="description" content="A pragmatic HTML5 Audio benchmark">
  <meta name="author" content="Tomás Senart">
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/awpy.css">
  <link rel="shortcut icon" href="/favicon.ico">
</head>
<body>
  <div class="container">
    <div class="content">
      <div class="page-header">
        <h1>Are We Playing Yet?</h1>
      </div>
      <div class="row">
        <div class="span10">
          <h2>A pragmatic HTML5 Audio browser benchmark</h2>
          <p>This project was started as an initiative to bring more harmony into HTML5 Audio implementation across different browsers. We want to build the best HTML5 audio player on the web and we need help from the browser developers for that. As the specifications left room to interpretation, some of the features got implemented not as well they could be.  We don't want to write code for different browsers, and to make this real we need to know that we can rely on them instead. Please join the discussion on <a href="http://twitter.com/areweplayingyet">@areweplayingyet</a>!</p>
          <p><button id="run" class="btn full-width">Run all the tests!</button></p>
        </div>
      </div>
      <div class="row">
        <div class="span10">
          <table id="tests" class="zebra-striped">
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div id="browserscope" class="row">
        <div class="span10">
          <h3>BrowserScope results</h3>
          <table class="zebra-striped">
            <thead>
              <tr>
                <td>Browser</td><td>Count</td><td>Score</td>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <footer>
      <p>&copy; SoundCloud 2011</p>
    </footer>

  </div>
  <script src="/js/augment-0.3.1.min.js"></script>
  <script src="/js/awpy.js"></script>
  <script>
  (function() {
    var list = AWPY.tests.get();
    var bigBtn = document.getElementById('run');
    var singleBtns = document.getElementsByClassName('run-single');
    var arr = function(foo) { return Array.prototype.slice.call(foo); };

    document.getElementById('tests').firstElementChild.innerHTML = list.map(function(test, i) {
      return '<tr class="test"><td><button class="btn run-single">Run</button></td><td>' + test.description + '</td><td><span class="label result">N/A</span></td></tr>';
    }).join('');

    var finalize = (function(){
      var counter = 0, tests = document.getElementsByClassName('test'), score = 0;
      return function() {
        var testNode = tests[list.indexOf(this)],
            resultNode = testNode.getElementsByClassName('result')[0],
            runBtnSingle = testNode.getElementsByClassName('run-single')[0];

        resultNode.className += (this.result === null ? ' warning' : this.result ? ' success' : ' important');
        resultNode.innerHTML =  (this.result === null ? 'TIMEOUT' : this.result ? 'WIN' : 'FAIL');

        runBtnSingle.innerHTML = 'Done!';

        if (this.result) {
          score++;
        }

        if (++counter === list.length) {
          arr(singleBtns).concat(bigBtn).forEach(function(btn, i) {
            btn.innerHTML = 'Done!';
          });

          bigBtn.innerHTML = 'Score: ' + score + '/' + list.length;
          // Save results to BrowserScope
          // AWPY.tests.save();
          // // Show BrowserScope widget
          // AWPY.tests.display();
        }
      };
    }());

    [bigBtn].concat(arr(singleBtns)).forEach(function(btn, i, all) {
      btn.addEventListener('click', function runTest() {
        btn.removeEventListener('click', runTest, false);
        btn.className += ' disabled';
        btn.innerHTML = 'Running…';
        if (!i) {
          all.forEach(function(btn) {
            btn.className += ' disabled';
            btn.innerHTML = 'Running…';
          });
        }
        AWPY.tests.run(i ? (i - 1) : -1, finalize);
      }, false)
    });

  }());
  </script>
</body>
</html>
