<!DOCTYPE html>
<html>
<head>
  <title>AreWePlayingYet?</title>
  <style>
    #player {
      width: 95%;
      height: 200px;
      position: relative;
      margin-top: 30px;
    }

    #buffered {
      background-color: red;
    }

    #seekable {
      background-color: blue;
    }

    #played {
      background-color: yellow;
    }

    #currentTime {
      width: 1px !important;
      background-color: black;
    }

    #player > div {
      position: absolute;
      width: 0;
      height: 100%;
    }


  </style>
</head>
<body>
  <h1>AreWePlayingYet?</h1>
  <h2>A pragmatic HTML5 Audio browser benchmark</h2>
  <p>This project was started as an initiative to bring more harmony into HTML5 Audio implementation across different browsers. We want to build the best HTML5 audio player on the web and we need help from the browser developers for that. As the specifications left room to interpretation, some of the features got implemented not as well they could be.  We don't want to write code for different browsers, and to make this real we need to know that we can rely on them instead. Please join the discussion on <a href="http://twitter.com/areweplayingyet">@areweplayingyet</a>!</p>


  <div id="player">
    <div id="buffered"></div>
    <div id="seekable"></div>
    <div id="played"></div>
    <div id="currentTime"></div>
  </div>

    <!-- Possible benchmarking


    preload attribute
    paused, played, muted, mute()
    buffered
    autoplay
    all events
    metadata preload - no preload to play delay
    redirects in streams (https->http, x-domain)
    redirects in streams invalidate (s3)
    the density of timeupdate events
    switching streams (android)


    supports more than ogg? -->
  <script>
    var AWPY = {
      about: { version: 0.1 },
      config: {
        codec: (function() {
          var audio = new Audio();
          if (audio.canPlayType && /probably|maybe/.test(audio.canPlayType('audio/mpeg'))) {
            return 'mp3'
          } else if (audio.canPlayType && /probably|maybe/.test(canPlayType('audio/ogg; codecs="vorbis"'))) {
            return 'ogg'
          } else {
            return 'wav'
          }
        }())
      }
    };

    AWPY.tests = (function() {
      var list = [];

      var init = function(tests) {
        list = tests;
      };

      var run = function(callback) {
        list.forEach(function(test) {
          test.assert(function(result) {
            callback.call(test, result);
          });
        });
      };

      var save = function(name) {
        // Post to browser scope
      };

      return {
        init: init,
        run: run,
        save: save
      };
    }());

    AWPY.sounds = {
      huge: {
        duration: 4046210,
        title: 'Psalm II (Mixtape)',
        artwork_url: 'http://i1.sndcdn.com/artworks-000012685887-ceu82b-large.jpg?3588dee',
        waveform_url: 'http://w1.sndcdn.com/uSIaVroNBknN_m.png',
        stream_url: '/sounds/huge.' + AWPY.config.codec,
      }
    };

    AWPY.tests.init([
      {
        description: 'Play unbuffered time. aka Seekahead',
        assert: function(finish) {
          var audio = AWPY.audio = new Audio(),
              sound = AWPY.sounds.huge;

          audio.addEventListener('canplay', function() {
            var seekTime = audio.buffered.end(0) + 60,
                seekDuration = 0;

            audio.addEventListener('seeking', function() {
              seekDuration = new Date();
            });

            audio.addEventListener('seeked', function() {
              seekDuration = (new Date()) - seekDuration;
              finish(seekDuration < 100);
            });

            audio.currentTime = seekTime;
          }, false);

          audio.setAttribute('src', AWPY.sounds.huge.stream_url);
          audio.load();
        }
      }
    ]);

    AWPY.tests.run(function(result) {
      var audio = AWPY.audio, sound = AWPY.sounds.huge;
      document.getElementById('buffered').style.width = ((audio.buffered.end(0) * 100) / (sound.duration / 1000)) + '%';
      document.getElementById('currentTime').style.left = ((audio.currentTime * 100) / (sound.duration / 1000)) + '%';
      console.log(this.description, result);
    });
  </script>
</body>
</html>
